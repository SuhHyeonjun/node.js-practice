```
< 블로그 링크 >
```
https://hstory0208.notion.site/JavaScript-c4713d5ebe0942eb8d13595598201d60


### 1️⃣ Node.js 란?

---

Node.js는 자바스크립트의 런타임( Runtime : 실행 환경, 실행기 ) 이다.

“자바스크립트로 짜진 코드를 돌려주는 환경”이라는 뜻.

> **Node.js 등장 전엔**
> 

원래에는 웹 브라우저안에서만 자바스크립트 코드를 실행할 수 있었다.

하지만 자바스크립트를 실행할 수 있는 Node.js가 등장함으로써

브라우저 밖에서도 자바스크립트 코드를 돌릴 수 있게 되었다.<br>
<br>
<br>
### 2️⃣ 동작방식

---

먼저 동기와 비동기에 대해 이해해야한다.

엄마가 3명의 아이들에게 사과, 딸기, 포도를 사오도록 심부름을 시키는 것을 예로들어 보자.

```jsx
 A : 엄마가 3명의 아이들이 하나의 카트를 끌고 사과, 딸기, 포도를 사오도록 한다.

 B : 엄마가 아이들 각자 하나의 카트를 끌고 물건을 배정해준뒤 사오도록 한다. 
```

> **A : 동기**
> 

엄마는 카트를 한 개만 가지고 아이 한 명의 심부름이 끝날 때 까지 다른 아이에게 심부름 기회를 주지 않는다.

이렇게 제어권을 넘겨주지 않고 대기하게 만드는 것을 블로킹 ( Blocking ) 이라고 한다.

또 카트 한 개만 가지고 3명의 아이가 사과 코너, 딸기 코너, 포도 코너를 순차적으로 간다.

이를 작업의 흐름이 순차적인 “**동기/블로킹 방식”**이라고 한다.

> **B : 비동기**
> 

엄마는 A와 다르게 아이들에게 별다른 제제를 하지 않고 다른 작업과 관계없이 각 자의 일을 수행할 수 있게 한다.

이걸 논블로킹 ( Non-Blocking ) 이라고 한다.

B 같은 상황을 아이들에게 심부름을 한번에 시켰지만 작업의 흐름이 순차적이지 않은 "비동기적/논블로킹” 방식이 라고한다.

만약 Node.js가 동기 방식을 선택했다면 하나의 자원 ( 즉 CPU )를 나누어 사용해 하나의 작업이 끝나고,

다음 작업이 완료됐다는 응답이 올 때 까지 기다리게 된다면 그 시간동안 자원을 낭비하는 문제가 생긴다.

그래서 **Node.js는 응답을 기다리지 않고 바로 다음 작업을 실행하는 비동기 방식을 사용**한다.

Node.js의 비동기적 특징은 Node.js 내부의 V8, libuv 등의 라이브러리를 자동으로 바인딩하여 실행해 주기 때문에 정확하게 이해하지 않아도

코딩하는데 큰 문제가 없다.

⇒ **바인딩 ( Binding ) :** 구체적인 속성 값을 할당하는 것.
<br>
<br>
### 3️⃣ 싱글 스레드와 이벤트 루프

---

Node.js는 싱글 스레드와 이벤트 루프를 기반으로 한다.

> **프로세스 스레드**
> 

작업관리자를 켜서 각 프로그램을 하나씩 끄는 경험을 해본 적이 있었을 것이다.

바로 그 하나의 프로그램이 “프로세스”다.

인터넷 서핑을 하기 위해 브라우저를 실행하는 것이 “프로세스” 이며,

그 브라우저 내에서 이동, 검색, 등 다른 작업을 수행하는 것을 “스레드”라고 한다.

> **이벤트 루프**
> 

Node.js가 싱글 스레드를 기반으로 하면 비동기 방식을 택하면서 어떻게 하나의 스레드로 빠르게 일 처리를 할까 ?

이 문제를 **이벤트 루프**가 해결 해준다.

Node.js는 응답을 기다리는 대신, 작업이 종료되면 이벤트를 발생시키고 콜백 큐( 작업 큐 )에 등록하는 방법을 사용한다.

응답을 기다리는 대신 다른 작업을 먼저 수행하는 쪽을 택한 것이다.

그렇다면 작업이 완료된 것을 어떻게 알까 ?

**바로 이벤트 루프가 계속 감시**하고 있기 때문이다.

이벤트 루프는 지속적으로 콜 스택이 비어 있는지 체크한다.

콜 스택이 비었으면 콜백 큐의 작업을 콜 스택으로 밀어 넣는다.

⇒ 콜 스택은 먼저 실행하는 작업이 있는 곳이고 콜백 큐는 나중에 실행할 작업이 있는 것이다.

```jsx
**콜백 큐 :** 이벤트 발생 후 호출되어야 할 작업을 기다리는 자료 구조 , 이벤트 큐라고도 함.
**콜 스택** : 함수의 호출을 기록하는 자료구조이며, 현재 실행 중인 작업이 끝났을 때 어느 실행 부분으로 돌아갈지 보관한다.
**콜백 함수** : 작업이 끝나면 실행하는 함수다.
```
<br>
<br>

### 4️⃣ Node.js가 동작하는 과정

---

1. “이벤트 루프”는 어떤 이벤트가 있는지 계속 감시하는 감시자다.
이벤트가 감지가 되면, 그 작업을 위해 작업 스레드를 생성한다.
2. 작업 스레드는 일종의 작업 공간이다.
이벤트를 처리하기 위해 이벤트 루프는 처리 작업을 작업 스레드에게 맡기고 다른 이벤트가 없나 다시 감시한다.
3. 작업 스레드가 작업을 받을 때, 콜백 함수를 받는다.
4. 작업 스레드는 작업을 마치면 이 콜백 함수를 실행하고 싶다고 최고 감시자인 이벤트 루프에게 응답을 보낸다.
5. 응답을 받은 이벤트 루프는 콜백 함수의 결과를 클라이언트에 전송하여 우리가 볼 수 있는 결과로 바꾸어준다.
